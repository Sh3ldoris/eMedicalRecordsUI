<div class="pt-2">
  <div class="patient-info shadow-sm" [ngClass]="!isInfoOpen ? 'rounded-all': 'rounded-top'">
    <div *ngIf="this.patient" class="row px-4 py-3">
      <div class="col-12">
        <div class="row g-0">
          <div class="col-auto d-none d-xl-block" style="padding-right: 1.5rem">
            <img *ngIf="this.patient.person.gender === 'MALE'" src="assets/images/Male-profile-icon.png" width="120" height="auto" class="img-fluid" alt="">
            <img *ngIf="this.patient.person.gender === 'FEMALE'" src="assets/images/Female-profile-icon.png" width="120" height="auto" class="img-fluid" alt="">
          </div>
          <div class="col-8 d-flex flex-column position-static">
            <mat-tab-group class="without-bottom-border">
              <mat-tab>
                <ng-template mat-tab-label>
                 Identifikácia
                </ng-template>

                <div class="row info">
                  <div class="field-names col-auto d-none d-lg-block">
                    <div class="row g-0 py-1">
                      <span class="text-end">Meno a priezvisko:</span>
                    </div>
                    <div class="row g-0 py-1">
                      <span class="text-end">Adresa bydliska:</span>
                    </div>
                    <div class="row g-0 py-1">
                      <span class="text-end">Telefónny kontakt:</span>
                    </div>
                  </div>
                  <div class="field-values col-auto d-block">
                    <div class="row g-0 py-1">
                      {{this.patient.person.firstName + ' ' + this.patient.person.lastName}}
                    </div>
                    <div class="row g-0 py-1">
                      {{this.patient.person.address}}
                    </div>
                    <div class="row g-0 py-1">
                      {{this.patient.person.phone}}
                    </div>
                  </div>
                </div>
              </mat-tab>

              <mat-tab>
                <ng-template mat-tab-label>
                  Poisťovňa
                </ng-template>

                <div class="row info">
                  <div class="field-names col-auto d-none d-lg-block">
                    <div class="row g-0 py-1">
                      <span class="text-end">Rodné číslo:</span>
                    </div>
                    <div class="row g-0 py-1">
                      <span class="text-end">Číslo poistenca:</span>
                    </div>
                    <div class="row g-0 py-1">
                      <span class="text-end">Kód poisťovne:</span>
                    </div>
                  </div>
                  <div class="field-values col-auto d-block">
                    <div class="row g-0 py-1">
                      {{this.patient.person.birthNumber}}
                    </div>
                    <div class="row g-0 py-1">
                      {{this.patient.code}}
                    </div>
                    <div class="row g-0 py-1">
                      {{this.patient.insurance.insuranceCode}}
                    </div>
                  </div>
                </div>
              </mat-tab>
            </mat-tab-group>
          </div>
          <div class="col d-flex flex-column position-static">
            <div class="d-flex justify-content-end align-items-center h-100">
              <button *ngIf="isInfoOpen"
                      class="btn btn-sm basic h-100"
                      type="submit"
                      (click)="editAnamnesis()"
                      style="margin-right: 0.5rem">
                 {{!isEditing ? 'Upraviť anamnézu': 'Uložiť zmeny'}}
              </button>
              <button (click)="openInfo()" type="submit" class="btn btn-sm h-100" [ngClass]="!isInfoOpen ? 'basic' : 'reset'">
                {{!isInfoOpen ? 'Zobraziť anamnézu': 'Zavrieť anamnézu'}}
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <hr *ngIf="isInfoOpen" class="m-0 p-0"/>
  </div>
  <div *ngIf="isInfoOpen" class="patient-info shadow-sm" style="border-bottom-left-radius: 7px; border-bottom-right-radius: 7px;">
    <div class="row px-4 py-3">
      <p class="">Anamnéza - osobná</p>
      <div class="col-12">
          <mat-form-field appearance="outline" [ngClass]="{'read-only': !isEditing}">
            <mat-label>Terajšie ochorenia</mat-label>
            <textarea matInput
                      cdkAutosizeMinRows="2"
                      cdkAutosizeMaxRows="6"
                      cdkTextareaAutosize="true"
                      readonly="{{!isEditing}}"
                      [(ngModel)]="this.anamnesis.currentDiseases">
          </textarea>
          </mat-form-field>
      </div>
      <div class="col-6">
        <mat-form-field appearance="outline" [ngClass]="{'read-only': !isEditing}">
          <mat-label>Predchádzajúce obdobie</mat-label>
          <textarea matInput
                    cdkAutosizeMinRows="2"
                    cdkAutosizeMaxRows="6"
                    cdkTextareaAutosize="true"
                    readonly="{{!isEditing}}"
                    [(ngModel)]="this.anamnesis.previousPeriod">
          </textarea>
        </mat-form-field>
      </div>
      <div class="col-6">
        <mat-form-field appearance="outline" [ngClass]="{'read-only': !isEditing}">
          <mat-label>Farmakologická anamnéza</mat-label>
          <textarea matInput
                    cdkAutosizeMinRows="2"
                    cdkAutosizeMaxRows="6"
                    cdkTextareaAutosize="true"
                    readonly="{{!isEditing}}"
                    [(ngModel)]="this.anamnesis.pharmacologyHistory">
          </textarea>
        </mat-form-field>
      </div>
      <div class="col-6">
        <mat-form-field appearance="outline" [ngClass]="{'read-only': !isEditing}">
          <mat-label>Alergie</mat-label>
          <textarea matInput
                    cdkAutosizeMinRows="2"
                    cdkAutosizeMaxRows="6"
                    cdkTextareaAutosize="true"
                    readonly="{{!isEditing}}"
                    [(ngModel)]="this.alergies">
          </textarea>
        </mat-form-field>
      </div>
      <div class="col-6">
        <mat-form-field appearance="outline" [ngClass]="{'read-only': !isEditing}">
          <mat-label>Abúzy</mat-label>
          <textarea matInput
                    cdkAutosizeMinRows="2"
                    cdkAutosizeMaxRows="6"
                    cdkTextareaAutosize="true"
                    readonly="{{!isEditing}}"
                    [(ngModel)]="this.anamnesis.abuses">
          </textarea>
        </mat-form-field>
      </div>
      <div class="col-6">
        <mat-form-field appearance="outline" [ngClass]="{'read-only': !isEditing}">
          <mat-label>Fyziologické funkcie</mat-label>
          <textarea matInput
                    cdkAutosizeMinRows="2"
                    cdkAutosizeMaxRows="6"
                    cdkTextareaAutosize="true"
                    readonly="{{!isEditing}}"
                    [(ngModel)]="this.anamnesis.physiologicalFunctions">
          </textarea>
        </mat-form-field>
      </div>
      <div class="col-6" *ngIf="patient.person.gender === 'FEMALE'">
        <mat-form-field appearance="outline" class="read-only">
          <mat-label>Gynekologická anamnéza</mat-label>
          <textarea matInput
                    cdkAutosizeMinRows="2"
                    cdkAutosizeMaxRows="6"
                    cdkTextareaAutosize="true"
                    readonly="{{!isEditing}}"
                    [(ngModel)]="this.anamnesis.gynecologicalHistory">
          </textarea>
        </mat-form-field>
      </div>
      <hr/>
      <p class="">Anamnéza - rodinná</p>
      <div class="col-12">
        <mat-form-field appearance="outline" [ngClass]="{'read-only': !isEditing}">
          <mat-label>Rodinná anamnéza</mat-label>
          <textarea matInput
                    cdkAutosizeMinRows="2"
                    cdkAutosizeMaxRows="6"
                    cdkTextareaAutosize="true"
                    readonly="{{!isEditing}}"
                    [(ngModel)]="this.anamnesis.familyAnamnesis">
          </textarea>
        </mat-form-field>
      </div>
      <hr/>
      <p class="">Anamnéza - ostatné</p>
      <div class="col-6">
        <mat-form-field appearance="outline" [ngClass]="{'read-only': !isEditing}">
          <mat-label>Pracovná anamnéza</mat-label>
          <textarea matInput
                    cdkAutosizeMinRows="2"
                    cdkAutosizeMaxRows="6"
                    cdkTextareaAutosize="true"
                    readonly="{{!isEditing}}"
                    [(ngModel)]="this.occupation">
          </textarea>
        </mat-form-field>
      </div>
      <div class="col-6">
        <mat-form-field appearance="outline" [ngClass]="{'read-only': !isEditing}">
          <mat-label>Sociálna anamnéza</mat-label>
          <textarea matInput
                    cdkAutosizeMinRows="2"
                    cdkAutosizeMaxRows="6"
                    cdkTextareaAutosize="true"
                    readonly="{{!isEditing}}"
                    [(ngModel)]="this.familyState">
          </textarea>
        </mat-form-field>
      </div>
    </div>
  </div>
</div>

<div class="mt-4">
  <button *ngIf="!isNewRecordFormOpen" type="submit" class="btn basic d-inline-block col-auto" (click)="openReportForm();">
    Pridať nový záznam
  </button>

  <ng-container *ngIf="isNewRecordFormOpen">
    <app-new-health-record [patientCode]="patient.code" (close)="onCloseReport($event)"></app-new-health-record>
  </ng-container>
</div>

<div class="mt-2">
  <app-health-record-list [records]="records"></app-health-record-list>
</div>

<div class="mt-4">
  <app-pagination></app-pagination>
</div>
